# üöÄ Zapier Email Triage Integration - User Setup Guide

## Overview

This guide walks through the complete process of connecting your email provider (Gmail, Outlook, etc.) to FollowThrough AI's email triage system via Zapier. Once set up, incoming emails will be automatically classified, summarized, and have reply drafts generated by AI agents.

## üìã Prerequisites

- FollowThrough AI account with email triage access
- Zapier account (free or paid)
- Email provider account (Gmail, Outlook, etc.)
- Admin permissions for your email inbox (if corporate)

---

## üîê Phase 1: Generate Your API Key

### Step 1: Log into FollowThrough AI

1. Go to your FollowThrough AI dashboard
2. Navigate to **Settings > Integrations > Zapier**
3. Click **"Generate New API Key"**
4. **Important**: Copy and securely store this API key
   ```
   zapier_a1b2c3d4e5f6g7h8i9j0k1l2m3n4o5p6q7r8s9t0u1v2w3x4y5z6
   ```

### Step 2: Test Your API Key (Optional)

Verify your API key works by testing it:

```bash
curl -X GET "https://your-domain.com/api/zapier/test" \
  -H "x-api-key: zapier_a1b2c3d4e5f6g7h8i9j0k1l2m3n4o5p6q7r8s9t0u1v2w3x4y5z6"

# Expected response:
{
  "status": "success",
  "message": "API key is valid",
  "userId": "user-123"
}
```

---

## ‚ö° Phase 2: Set Up Zapier Integration

### Step 1: Create a New Zap

1. Log into your Zapier account
2. Click **"Create Zap"**
3. Choose your email provider as the **Trigger**:
   - **Gmail**: "New Email" or "New Email Matching Search"
   - **Outlook**: "New Email" or "New Email Matching Search"
   - **Other providers**: Look for email trigger options

### Step 2: Configure Email Trigger

#### For Gmail:
1. **Trigger Event**: Choose "New Email Matching Search"
2. **Connect Account**: Authorize Zapier to access your Gmail
3. **Configure Search**: 
   ```
   to:support@yourcompany.com OR to:help@yourcompany.com
   is:unread
   ```
4. **Test Trigger**: Send a test email to verify it's captured

#### For Outlook:
1. **Trigger Event**: Choose "New Email"
2. **Connect Account**: Authorize Zapier to access your Outlook
3. **Folder**: Choose your inbox or specific support folder
4. **Test Trigger**: Send a test email to verify it's captured

### Step 3: Configure FollowThrough AI Action

1. **Action Event**: Choose "Webhooks by Zapier"
2. **Action**: Select "POST"
3. **URL**: 
   ```
   https://your-domain.com/api/zapier/webhooks/email
   ```
4. **Method**: POST
5. **Headers**:
   ```json
   {
     "Content-Type": "application/json",
     "x-api-key": "zapier_a1b2c3d4e5f6g7h8i9j0k1l2m3n4o5p6q7r8s9t0u1v2w3x4y5z6"
   }
   ```

### Step 4: Configure Request Body

Map the email data from your trigger to our expected format:

```json
{
  "id": "{{1__id}}",
  "subject": "{{1__subject}}",
  "from": "{{1__from__email}}",
  "to": "{{1__to}}",
  "body": "{{1__body_html}}",
  "timestamp": "{{1__date}}",
  "headers": {
    "message-id": "{{1__message_id}}",
    "reply-to": "{{1__reply_to}}"
  },
  "userId": "your-user-id-here"
}
```

**Field Mapping Guide:**
- `{{1__id}}` ‚Üí Unique email ID from your provider
- `{{1__subject}}` ‚Üí Email subject line
- `{{1__from__email}}` ‚Üí Sender's email address
- `{{1__to}}` ‚Üí Recipient email (your support address)
- `{{1__body_html}}` ‚Üí Email body content (HTML preferred)
- `{{1__date}}` ‚Üí Email timestamp
- `{{1__message_id}}` ‚Üí Email message ID
- `{{1__reply_to}}` ‚Üí Reply-to address if different from sender

---

## üß™ Phase 3: Testing Your Integration

### Step 1: Test the Zap

1. In Zapier, click **"Test & Continue"**
2. Send a test email to your support address
3. Verify the email is captured by the trigger
4. Verify the webhook is sent successfully

### Step 2: Check FollowThrough AI Dashboard

1. Go to your FollowThrough AI dashboard
2. Navigate to **Email Triage** section
3. Look for your test email with:
   - **Priority Classification** (urgent, high, normal, low)
   - **Category Classification** (bug_report, feature_request, question, etc.)
   - **AI-Generated Summary** (problem, context, ask)
   - **Reply Draft** (ready-to-send response)

### Expected Result:
```json
{
  "success": true,
  "sessionId": "zapier-email-1704449400000",
  "emailId": "email-12345",
  "processedAt": "2024-01-15T10:30:15Z",
  "result": {
    "classification": {
      "priority": "high",
      "category": "bug_report",
      "confidence": 0.89,
      "reasoning": "Customer reporting payment processing issues"
    },
    "summary": {
      "problem": "Payment processing failures during checkout",
      "context": "E-commerce customer unable to complete purchase",
      "ask": "Fix payment gateway integration",
      "summary": "Customer experiencing payment gateway errors preventing purchase completion"
    },
    "replyDraft": {
      "subject": "Re: Payment Processing Issue - We're on it!",
      "body": "Hi John,\n\nThank you for reporting this payment issue. We understand how frustrating this must be and are immediately investigating the payment gateway. Our technical team has been notified and we'll provide an update within 2 hours.\n\nBest regards,\nSupport Team",
      "tone": "professional",
      "next_steps": ["Investigate payment gateway", "Update customer within 2 hours"]
    }
  }
}
```

---

## ‚öôÔ∏è Phase 4: Advanced Configuration

### Batch Processing (Optional)

For high-volume email processing, you can set up batch processing:

**Webhook URL**: 
```
https://your-domain.com/api/zapier/webhooks/email/batch
```

**Request Body**:
```json
{
  "emails": [
    {
      "id": "email-1",
      "subject": "Bug Report",
      "from": "customer1@example.com",
      "body": "..."
    },
    {
      "id": "email-2", 
      "subject": "Feature Request",
      "from": "customer2@example.com",
      "body": "..."
    }
  ]
}
```

### Filtering Options

You can add filters to only process certain emails:

1. **Priority Senders**: Only process emails from VIP customers
2. **Subject Keywords**: Only process emails with specific keywords
3. **Time-based**: Only process emails during business hours
4. **Department Routing**: Route to different teams based on content

### Error Handling

If processing fails, you'll receive:
```json
{
  "success": false,
  "error": {
    "message": "Processing failed: Invalid email format",
    "code": "EMAIL_PROCESSING_FAILED",
    "timestamp": "2024-01-15T10:30:15Z"
  },
  "emailId": "email-12345"
}
```

---

## üéØ Phase 5: Using the Results

### Dashboard Integration

After emails are processed, you can:

1. **View Triaged Emails**: See all processed emails with AI analysis
2. **Send Replies**: Use AI-generated drafts or customize them
3. **Prioritize Work**: Sort by urgency and category
4. **Delegate Tasks**: Assign emails to team members
5. **Snooze Emails**: Temporarily hide non-urgent items
6. **Track Performance**: Monitor response times and resolution rates

### API Integration

You can also retrieve results programmatically:

```typescript
// Get results for a specific session
GET /api/email/results/session/{sessionId}
Authorization: Bearer <your_jwt_token>

// Response:
{
  "sessionId": "zapier-email-1704449400000",
  "status": "completed",
  "classification": { ... },
  "summary": { ... },
  "replyDraft": { ... },
  "processedAt": "2024-01-15T10:30:15Z"
}
```

### WebSocket Real-time Updates

Connect to real-time updates:

```javascript
const socket = io('wss://your-domain.com');

socket.on('email.triage.completed', (data) => {
  console.log('New email processed:', data);
  updateDashboard(data.result);
});

socket.on('email.priority.urgent', (data) => {
  console.log('URGENT email detected:', data);
  showUrgentAlert(data.result);
});
```

---

## üõ†Ô∏è Troubleshooting

### Common Issues

**1. "API key is missing" Error**
- Verify the `x-api-key` header is set correctly in Zapier
- Check that your API key hasn't expired
- Regenerate API key if needed

**2. "Invalid API key" Error**
- Verify you copied the full API key including the `zapier_` prefix
- Check that the API key belongs to the correct user account

**3. Email Not Being Processed**
- Verify your Zapier trigger is properly configured
- Check that test emails are being captured by the trigger
- Verify the webhook URL is correct and accessible

**4. Processing Timeout**
- Large emails may take longer to process
- Check your email body size (max recommended: 50KB)
- Consider using plain text instead of HTML for faster processing

### Getting Help

1. **Logs**: Check the Zapier task history for error details
2. **API Testing**: Use the test endpoint to verify connectivity
3. **Support**: Contact support@followthroughai.com with:
   - Your API key (first 10 characters only)
   - Error messages from Zapier
   - Example email that failed to process

---

## üîí Security Considerations

1. **API Key Storage**: Keep your API key secure and don't share it
2. **Rate Limiting**: We limit API calls to prevent abuse
3. **Data Privacy**: Emails are processed securely and not stored permanently
4. **Access Control**: API keys are tied to your user account
5. **Revocation**: You can revoke API keys anytime from your dashboard

---

## üìä Monitoring & Analytics

Track your integration performance:

1. **Processing Volume**: How many emails are being processed
2. **Processing Time**: Average time from receipt to completion  
3. **Accuracy Rates**: How often AI classifications are correct
4. **Response Times**: How quickly you respond to triaged emails
5. **Error Rates**: Monitor failed processing attempts

### Success Metrics

- **Reduced Manual Triage Time**: 70-90% reduction typical
- **Faster Response Times**: 50-80% improvement in first response
- **Better Prioritization**: Critical emails identified immediately
- **Consistent Quality**: AI-generated replies maintain professional tone

---

## üéâ Congratulations!

Your Zapier integration is now complete! Incoming emails will be automatically:
- **Classified** by priority and category
- **Summarized** with key problem, context, and ask
- **Drafted** with professional reply suggestions
- **Routed** to your dashboard for quick action

This integration typically saves 2-4 hours per day for customer support teams while improving response quality and consistency. 